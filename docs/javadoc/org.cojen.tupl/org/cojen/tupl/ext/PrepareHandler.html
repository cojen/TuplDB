<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>PrepareHandler (Tupl 1.5.0 API)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: module: org.cojen.tupl, package: org.cojen.tupl.ext, interface: PrepareHandler">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var data = {"i0":6,"i1":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "alt-color";
var rowColor = "row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar.top">
<div class="skip-nav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar.top.firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../module-summary.html">Module</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/PrepareHandler.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip.navbar.top">
<!--   -->
</span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="module-label-in-type">Module</span>&nbsp;<a href="../../../../module-summary.html">org.cojen.tupl</a></div>
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">org.cojen.tupl.ext</a></div>
<h1 title="Interface PrepareHandler" class="title">Interface PrepareHandler</h1>
</div>
<section class="description">
<dl class="notes">
<dt>All Superinterfaces:</dt>
<dd><code><a href="Handler.html" title="interface in org.cojen.tupl.ext">Handler</a></code></dd>
</dl>
<hr>
<pre>public interface <span class="type-name-label">PrepareHandler</span>
extends <a href="Handler.html" title="interface in org.cojen.tupl.ext">Handler</a></pre>
<div class="block">Handler for prepared transactions. Instances which are passed to the <a href="../DatabaseConfig.html#prepareHandlers(java.util.Map)"><code>prepareHandlers</code></a> method support recovery, and companion
 instances for creating prepared transactions are provided by the <a href="../Database.html#prepareWriter(java.lang.String)"><code>Database.prepareWriter</code></a> method.</div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method.summary">
<h2>Method Summary</h2>
<div class="member-summary" id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" id="t0" class="active-table-tab">All Methods</button><button role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" id="t2" class="table-tab" onclick="show(2);">Instance Methods</button><button role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" id="t3" class="table-tab" onclick="show(4);">Abstract Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<table class="summary-table" aria-labelledby="t0">
<thead>
<tr>
<th class="col-first" scope="col">Modifier and Type</th>
<th class="col-second" scope="col">Method</th>
<th class="col-last" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="alt-color" id="i0">
<td class="col-first"><code>void</code></td>
<th class="col-second" scope="row"><code><span class="member-name-link"><a href="#prepare(org.cojen.tupl.Transaction,byte%5B%5D)">prepare</a></span>&#8203;(<a href="../Transaction.html" title="interface in org.cojen.tupl">Transaction</a>&nbsp;txn,
byte[]&nbsp;message)</code></th>
<td class="col-last">
<div class="block">Called to prepare a transaction or to recover one.</div>
</td>
</tr>
<tr class="row-color" id="i1">
<td class="col-first"><code>void</code></td>
<th class="col-second" scope="row"><code><span class="member-name-link"><a href="#prepareCommit(org.cojen.tupl.Transaction,byte%5B%5D)">prepareCommit</a></span>&#8203;(<a href="../Transaction.html" title="interface in org.cojen.tupl">Transaction</a>&nbsp;txn,
byte[]&nbsp;message)</code></th>
<td class="col-last">
<div class="block">A prepare variant intended to be called by a two-phase commit coordinator after all
 participants have prepared their transactions.</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="inherited-list">
<h3 id="methods.inherited.from.class.org.cojen.tupl.ext.Handler">Methods inherited from interface&nbsp;org.cojen.tupl.ext.<a href="Handler.html" title="interface in org.cojen.tupl.ext">Handler</a></h3>
<code><a href="Handler.html#init(org.cojen.tupl.Database)">init</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method.detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="prepare(org.cojen.tupl.Transaction,byte[])">
<h3>prepare</h3>
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="member-name">prepare</span>&#8203;(<span class="parameters"><a href="../Transaction.html" title="interface in org.cojen.tupl">Transaction</a>&nbsp;txn,
byte[]&nbsp;message)</span>
      throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></span></div>
<div class="block">Called to prepare a transaction or to recover one. Exclusive locks acquired by the
 transaction are always recovered, whether they were acquired explicitly or
 automatically. Shared and upgradable locks aren't recovered.

 <p>When a transaction is initially prepared, non-exclusive locks are released, and the
 application should attempt to drive the transaction to completion. If the application
 crashes before this, or if leadership is lost, the recovery handler instance takes over.
 It will be invoked on the group member which has become the new leader.

 <p>When an <a href="../UnmodifiableReplicaException.html" title="class in org.cojen.tupl"><code>UnmodifiableReplicaException</code></a> is thrown from a commit or rollback
 operation, this signals that a recovery handler must take over. This exception can also
 be thrown within recovery, which signals that a replacement recovery will take over. To
 ensure that the handoff occurs, the reset method must be called on transaction which
 threw the exception. Failing to do this might require that the application be restarted
 to unstick the prepared transaction.

 <p>If an <a href="../UnmodifiableReplicaException.html" title="class in org.cojen.tupl"><code>UnmodifiableReplicaException</code></a> is thrown from the recovery handler, the
 necessary reset is performed automatically. Any other exception is propagated as an
 <a href="../EventType.html#RECOVERY_HANDLER_UNCAUGHT">uncaught</a> exception, and the prepared
 transaction might remain in a stuck state.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>txn</code> - transaction the prepare applies to, which can be modified</dd>
<dd><code>message</code> - optional message</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/lang/NullPointerException.html" title="class or interface in java.lang" class="external-link">NullPointerException</a></code> - if transaction or message is null</dd>
<dd><code><a href="https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="prepareCommit(org.cojen.tupl.Transaction,byte[])">
<h3>prepareCommit</h3>
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="member-name">prepareCommit</span>&#8203;(<span class="parameters"><a href="../Transaction.html" title="interface in org.cojen.tupl">Transaction</a>&nbsp;txn,
byte[]&nbsp;message)</span>
            throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></span></div>
<div class="block">A prepare variant intended to be called by a two-phase commit coordinator after all
 participants have prepared their transactions. All changes made up to the prepare are
 effectively committed, their locks are released, and the changes cannot be rolled
 back. This permits the changes to be observed outside the transaction.

 <p>To fully complete the prepared transaction, a commit operation must still be called
 to finish it, but only after all participants have committed their transactions. If not
 finished, the recovery handler will be invoked after each failover. A rollback operation
 can also finish the prepared transaction, although it will not roll back any changes
 made before the prepare.

 <p>Strictly speaking, this variant isn't required. The benefit is that a coordinator can
 perform the second phase of a two-phase commit without its own transaction getting
 "stuck" while waiting for participants to commit. Another benefit is that no special
 state needs to encoded in the prepare message to inform the recovery handler that it
 should act as a coordinator. Being invoked by this method alone is all that's needed.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>txn</code> - transaction the prepare applies to, which can be modified</dd>
<dd><code>message</code> - optional message</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/lang/NullPointerException.html" title="class or interface in java.lang" class="external-link">NullPointerException</a></code> - if transaction or message is null</dd>
<dd><code><a href="https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></code></dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottom-nav" id="navbar.bottom">
<div class="skip-nav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar.bottom.firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../module-summary.html">Module</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/PrepareHandler.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
</div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<span class="skip-nav" id="skip.navbar.bottom">
<!--   -->
</span></nav>
<p class="legal-copy"><small>Copyright &#169; 2011&#x2013;2020 <a href="https://github.com/cojen">Cojen</a>. All rights reserved.</small></p>
</footer>
</div>
</div>
</body>
</html>
