<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (23) -->
<title>PrepareHandler (TuplDB 1.9.0 API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: module: org.cojen.tupl, package: org.cojen.tupl.ext, interface: PrepareHandler">
<meta name="generator" content="javadoc/ClassWriter">
<link rel="stylesheet" type="text/css" href="../../../../../resource-files/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../resource-files/stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script-files/script.js"></script>
<script type="text/javascript" src="../../../../../script-files/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../../script-files/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">const pathtoroot = "../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="nav-content">
<div class="nav-menu-button"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button></div>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../module-summary.html">Module</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/PrepareHandler.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../../search.html">Search</a></li>
<li><a href="../../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
</div>
<div class="sub-nav">
<div class="nav-content">
<ol class="sub-nav-list">
<li><a href="../../../../module-summary.html">org.cojen.tupl</a></li>
<li><a href="package-summary.html">org.cojen.tupl.ext</a></li>
<li><a href="PrepareHandler.html" class="current-selection">PrepareHandler</a></li>
</ol>
<div class="nav-list-search">
<input type="text" id="search-input" disabled placeholder="Search" aria-label="Search in documentation" autocomplete="off">
<input type="reset" id="reset-search" disabled value="Reset">
</div>
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="main-grid">
<nav role="navigation" class="toc" aria-label="Table of contents">
<div class="toc-header">Contents&nbsp;
<input type="text" class="filter-input" disabled placeholder="Filter" aria-label="Filter table of contents" autocomplete="off">
<input type="reset" class="reset-filter" disabled value="Reset">
</div>
<button class="hide-sidebar"><span>Hide sidebar&nbsp;</span>&#10094;</button><button class="show-sidebar">&#10095;<span>&nbsp;Show sidebar</span></button>
<ol class="toc-list">
<li><a href="#" tabindex="0">Description</a></li>
<li><a href="#method-summary" tabindex="0">Method Summary</a></li>
<li><a href="#method-detail" tabindex="0">Method Details</a>
<ol class="toc-list">
<li><a href="#prepare(org.cojen.tupl.Transaction,byte%5B%5D)" tabindex="0">prepare(Transaction, byte[])</a></li>
<li><a href="#prepareCommit(org.cojen.tupl.Transaction,byte%5B%5D)" tabindex="0">prepareCommit(Transaction, byte[])</a></li>
</ol>
</li>
</ol>
</nav>
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<h1 title="Interface PrepareHandler" class="title">Interface PrepareHandler</h1>
</div>
<section class="class-description" id="class-description">
<div class="horizontal-scroll">
<dl class="notes">
<dt>All Superinterfaces:</dt>
<dd><code><a href="Handler.html" title="interface in org.cojen.tupl.ext">Handler</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="modifiers">public interface </span><span class="element-name type-name-label">PrepareHandler</span><span class="extends-implements">
extends <a href="Handler.html" title="interface in org.cojen.tupl.ext">Handler</a></span></div>
<div class="block">Handler for prepared transactions. Instances which are passed to the <a href="../DatabaseConfig.html#prepareHandlers(java.util.Map)"><code>prepareHandlers</code></a> method support recovery, and companion
 instances for creating prepared transactions are provided by the <a href="../Database.html#prepareWriter(java.lang.String)"><code>Database.prepareWriter</code></a> method.</div>
</div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab3" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab3', 3)" class="table-tab">Abstract Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel" aria-labelledby="method-summary-table-tab0">
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#prepare(org.cojen.tupl.Transaction,byte%5B%5D)" class="member-name-link">prepare</a><wbr>(<a href="../Transaction.html" title="interface in org.cojen.tupl">Transaction</a>&nbsp;txn,
 byte[]&nbsp;message)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Called to prepare a transaction or to recover one.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#prepareCommit(org.cojen.tupl.Transaction,byte%5B%5D)" class="member-name-link">prepareCommit</a><wbr>(<a href="../Transaction.html" title="interface in org.cojen.tupl">Transaction</a>&nbsp;txn,
 byte[]&nbsp;message)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">A prepare variant intended to be called by a two-phase commit coordinator after all
 participants have prepared their transactions.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-org.cojen.tupl.ext.Handler">Methods inherited from interface&nbsp;org.cojen.tupl.ext.<a href="Handler.html" title="interface in org.cojen.tupl.ext">Handler</a></h3>
<code><a href="Handler.html#init(org.cojen.tupl.Database)">init</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="prepare(org.cojen.tupl.Transaction,byte[])">
<h3>prepare</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="element-name">prepare</span><wbr><span class="parameters">(<a href="../Transaction.html" title="interface in org.cojen.tupl">Transaction</a>&nbsp;txn,
 byte[]&nbsp;message)</span>
      throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></span></div>
<div class="block">Called to prepare a transaction or to recover one. Exclusive locks acquired by the
 transaction are always recovered, whether they were acquired explicitly or
 automatically. Shared and upgradable locks aren't recovered.

 <p>When a transaction is initially prepared, non-exclusive locks are released, and the
 application should attempt to drive the transaction to completion. If the application
 crashes before this, or if leadership is lost, the recovery handler instance takes over.
 It will be invoked on the group member which has become the new leader.

 <p>When an <a href="../UnmodifiableReplicaException.html" title="class in org.cojen.tupl"><code>UnmodifiableReplicaException</code></a> is thrown from a commit or rollback
 operation, this signals that a recovery handler must take over. This exception can also
 be thrown within recovery, which signals that a replacement recovery will take over. To
 ensure that the handoff occurs, the reset method must be called on transaction which
 threw the exception. Failing to do this might require that the application be restarted
 to unstick the prepared transaction.

 <p>If an <a href="../UnmodifiableReplicaException.html" title="class in org.cojen.tupl"><code>UnmodifiableReplicaException</code></a> is thrown from the recovery handler, the
 necessary reset is performed automatically. Any other exception is propagated as an
 <a href="../diag/EventType.html#RECOVERY_HANDLER_UNCAUGHT">uncaught</a> exception, and the prepared
 transaction might remain in a stuck state.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>txn</code> - transaction the prepare applies to, which can be modified</dd>
<dd><code>message</code> - optional message</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/NullPointerException.html" title="class or interface in java.lang" class="external-link">NullPointerException</a></code> - if transaction or message is null</dd>
<dd><code><a href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></code></dd>
</dl>
</div>
</section>
</li>
<li>
<section class="detail" id="prepareCommit(org.cojen.tupl.Transaction,byte[])">
<h3>prepareCommit</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="element-name">prepareCommit</span><wbr><span class="parameters">(<a href="../Transaction.html" title="interface in org.cojen.tupl">Transaction</a>&nbsp;txn,
 byte[]&nbsp;message)</span>
            throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></span></div>
<div class="block">A prepare variant intended to be called by a two-phase commit coordinator after all
 participants have prepared their transactions. All changes made up to the prepare are
 effectively committed, their locks are released, and the changes cannot be rolled
 back. This permits the changes to be observed outside the transaction.

 <p>To fully complete the prepared transaction, a commit operation must still be called
 to finish it, but only after all participants have committed their transactions. If not
 finished, the recovery handler will be invoked after each failover. A rollback operation
 can also finish the prepared transaction, although it will not roll back any changes
 made before the prepare.

 <p>Strictly speaking, this variant isn't required. The benefit is that a coordinator can
 perform the second phase of a two-phase commit without its own transaction getting
 "stuck" while waiting for participants to commit. Another benefit is that no special
 state needs to encoded in the prepare message to inform the recovery handler that it
 should act as a coordinator. Being invoked by this method alone is all that's needed.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>txn</code> - transaction the prepare applies to, which can be modified</dd>
<dd><code>message</code> - optional message</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/NullPointerException.html" title="class or interface in java.lang" class="external-link">NullPointerException</a></code> - if transaction or message is null</dd>
<dd><code><a href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></code></dd>
</dl>
</div>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small>Copyright &#169; 2011&#x2013;2024 <a href="https://github.com/cojen">Cojen</a>. All rights reserved.</small></p>
</footer>
</main>
</div>
</body>
</html>
